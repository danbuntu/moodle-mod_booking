{"version":3,"file":"bookingPolicy.min.js","sources":["../../src/condition/bookingPolicy.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @module     mod_booking/condition/bookingPolicy\n * @copyright  Wunderbyte GmbH <info@wunderbyte.at>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport DynamicForm from 'core_form/dynamicform';\n\nconst SELECTOR = {\n    FORMCONTAINER: '.condition-bookingpolicy-form',\n    PREPAGEBODY: '.prepage-body',\n    CONTINUECONTAINER: ' div.prepage-booking-footer .continue-container',\n    CONTINUEBUTTON: ' div.prepage-booking-footer .continue-button',\n    BOOKINGBUTTON: '[data-area=\"subbooking\"][data-itemid=\"',\n};\n\n/**\n * Init function.\n * @param {*} elementid\n */\nexport async function init(elementid) {\n\n    // eslint-disable-next-line no-console\n    console.log(elementid);\n\n    let container = document.querySelector(\"#\" + elementid + \" \" + SELECTOR.FORMCONTAINER);\n\n    // eslint-disable-next-line no-console\n    console.log(elementid, container);\n\n    // If we don't find the container like this, we use the inline form.\n    if (!container) {\n        const containers = document.querySelectorAll(\"div.prepage-body \" + SELECTOR.FORMCONTAINER);\n        containers.forEach(el => {\n            if (!isHidden(el)) {\n                container = el;\n            }\n        });\n\n        if (!container) {\n            return;\n        }\n    }\n\n    const id = container.dataset.id;\n\n    const dynamicForm = new DynamicForm(container, 'mod_booking\\\\form\\\\condition\\\\bookingpolicy_form');\n\n    // We need to render the dynamic form right away, so we can acutally have all the necessary elements present.\n    await dynamicForm.load({id: id});\n\n    let continuebutton = container.closest(SELECTOR.PREPAGEBODY).querySelector(SELECTOR.CONTINUEBUTTON);\n\n    dynamicForm.addEventListener(dynamicForm.events.FORM_SUBMITTED, e => {\n        const response = e.detail;\n\n        if (response) {\n\n            if (!continuebutton) {\n                continuebutton = container.closest(SELECTOR.PREPAGEBODY).querySelector(SELECTOR.CONTINUEBUTTON);\n            }\n            if (continuebutton) {\n\n                continuebutton.dataset.blocked = 'false';\n                continuebutton.click();\n\n                // eslint-disable-next-line no-console\n                console.log('just clicked continue', continuebutton);\n            }\n        }\n    });\n\n    // This goes on continue button.\n    // It will prevent the action to be triggered.\n    // Unless the form is validated (see above).\n    if (continuebutton) {\n        continuebutton.dataset.blocked = true;\n        continuebutton.addEventListener('click', () => {\n\n            if (continuebutton.dataset.blocked == 'true') {\n                dynamicForm.submitFormAjax();\n            }\n        });\n    }\n}\n\n/**\n * Function to check visibility of element.\n * @param {*} el\n * @returns {boolean}\n */\nfunction isHidden(el) {\n    var style = window.getComputedStyle(el);\n    return ((style.display === 'none') || (style.visibility === 'hidden'));\n}"],"names":["obj","async","elementid","console","log","container","document","querySelector","SELECTOR","FORMCONTAINER","querySelectorAll","forEach","el","style","window","getComputedStyle","display","visibility","isHidden","id","dataset","dynamicForm","DynamicForm","load","continuebutton","closest","PREPAGEBODY","CONTINUEBUTTON","addEventListener","events","FORM_SUBMITTED","e","detail","blocked","click","submitFormAjax","_dynamicform","__esModule","default","CONTINUECONTAINER","BOOKINGBUTTON"],"mappings":"kHAqBgD,IAAAA;;;;;2EAczCC,eAAoBC,WAGvBC,QAAQC,IAAIF,WAEZ,IAAIG,UAAYC,SAASC,cAAc,IAAML,UAAY,IAAMM,SAASC,eAMxE,GAHAN,QAAQC,IAAIF,UAAWG,YAGlBA,UAAW,CAQZ,GAPmBC,SAASI,iBAAiB,oBAAsBF,SAASC,eACjEE,SAAQC,MA0D3B,SAAkBA,IACd,IAAIC,MAAQC,OAAOC,iBAAiBH,IACpC,MAA2B,SAAlBC,MAAMG,SAA6C,WAArBH,MAAMI,UACjD,EA5DiBC,CAASN,MACVP,UAAYO,GAChB,KAGCP,UACD,MAER,CAEA,MAAMc,GAAKd,UAAUe,QAAQD,GAEvBE,YAAc,IAAIC,aAAAA,QAAYjB,UAAW,0DAGzCgB,YAAYE,KAAK,CAACJ,GAAIA,KAE5B,IAAIK,eAAiBnB,UAAUoB,QAAQjB,SAASkB,aAAanB,cAAcC,SAASmB,gBAEpFN,YAAYO,iBAAiBP,YAAYQ,OAAOC,gBAAgBC,IAC3CA,EAAEC,SAIVR,iBACDA,eAAiBnB,UAAUoB,QAAQjB,SAASkB,aAAanB,cAAcC,SAASmB,iBAEhFH,iBAEAA,eAAeJ,QAAQa,QAAU,QACjCT,eAAeU,QAGf/B,QAAQC,IAAI,wBAAyBoB,iBAE7C,IAMAA,iBACAA,eAAeJ,QAAQa,SAAU,EACjCT,eAAeI,iBAAiB,SAAS,KAEC,QAAlCJ,eAAeJ,QAAQa,SACvBZ,YAAYc,gBAChB,IAGZ,EA9EAC,cAAgDpC,IAAhDoC,eAAgDpC,IAAAqC,WAAArC,IAAAsC,CAAAA,QAAAtC,KAEhD,MAAMQ,SAAW,CACbC,cAAe,gCACfiB,YAAa,gBACba,kBAAmB,kDACnBZ,eAAgB,+CAChBa,cAAe,yCAiFlB"}