{"version":3,"file":"dynamicactionsform.min.js","sources":["../src/dynamicactionsform.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/*\n * @package    mod_booking\n * @author     Bernhard Fischer\n * @copyright  Wunderbyte GmbH <info@wunderbyte.at>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * Dynamic semesters form.\n *\n * @module     mod_booking/dynamicactionsform\n * @copyright  2023 Wunderbyte GmbH\n * @author     Georg MaiÃŸer\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {get_string as getString} from 'core/str';\nimport ModalForm from 'core_form/modalform';\n\nconst SELECTOR = {\n    'buttons': '.booking-actions-container .btn'\n};\n\nexport const init = () => {\n\n    // eslint-disable-next-line no-console\n    console.log(SELECTOR.buttons);\n\n    const elements = document.querySelectorAll(SELECTOR.buttons);\n\n    // eslint-disable-next-line no-console\n    console.log(elements);\n\n    elements.forEach(element => {\n\n        // If the data-action is add-or-edit, we add the edit modal.\n\n        element.addEventListener('click', e => {\n\n            editActionsModal(e.target);\n\n        });\n    });\n};\n\n/**\n *  Function to show modal elemnt.\n * @param {HTMLElement} element\n */\nfunction editActionsModal(element) {\n\n    if (!element) {\n        return;\n    }\n\n    const actionid = element.dataset.id;\n    const action = element.dataset.action;\n    const optionid = element.dataset.optionid;\n    const cmid = element.dataset.cmid;\n\n    if (!actionid) {\n        return;\n    }\n\n    if (action == \"delete\") {\n        // A action is deleted.\n        const deleteForm = new ModalForm({\n\n            // Name of the class where form is defined (must extend \\core_form\\dynamic_form):\n            formClass: \"mod_booking\\\\form\\\\actions\\\\deleteactionsform\",\n            // Add as many arguments as you need, they will be passed to the form:\n            args: {id: actionid, cmid, optionid},\n            // Pass any configuration settings to the modal dialogue, for example, the title:\n            modalConfig: {\n                title: getString('deletebookingaction', 'mod_booking')\n            },\n            // DOM element that should get the focus after the modal dialogue is closed:\n            returnFocus: element\n        });\n\n        // After submitting we want to reload the window to update the action list.\n        deleteForm.addEventListener(deleteForm.events.FORM_SUBMITTED, () => {\n            window.location.reload();\n        });\n\n        // Show the form.\n        deleteForm.show();\n\n    } else if (action == \"edit-or-new\") {\n        // A action is added (actionid == 0) or edited (actionid > 0).\n        const modalForm = new ModalForm({\n            // Name of the class where form is defined (must extend \\core_form\\dynamic_form):\n            formClass: \"mod_booking\\\\form\\\\actions\\\\actionsform\",\n            // Add as many arguments as you need, they will be passed to the form:\n            args: {id: actionid, cmid, optionid},\n            // Pass any configuration settings to the modal dialogue, for example, the title:\n            modalConfig: {title: getString('editaction', 'mod_booking')},\n            // DOM element that should get the focus after the modal dialogue is closed:\n            returnFocus: element\n        });\n\n        // Listen to events if you want to execute something on form submit.\n        // Event detail will contain everything the process() function returned:\n        modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, () => {\n\n            // After adding or editing, we want to reload the window to update the action list.\n            window.location.reload();\n        });\n\n        // We need to add an event listener for the change of the action, action, and condition select.\n        modalForm.addEventListener('change', (e) => {\n\n            // eslint-disable-next-line no-console\n            console.log(e.target.name, e.target.value);\n\n            if (!e.target.name) {\n                return;\n            }\n\n            if (e.target.name == 'action_type') {\n                window.skipClientValidation = true;\n                let button = document.querySelector('[name=\"btn_actiontype\"]');\n                modalForm.processNoSubmitButton(button);\n            }\n        });\n\n        // Show the form.\n        modalForm.show();\n    } else {\n        // eslint-disable-next-line no-console\n        console.log('Error in dynamicactionsform.js: action should be \"delete\" or \"edit-or-new\".');\n        return;\n    }\n}\n"],"names":["obj","_modalform","__esModule","default","SELECTOR","_exports","init","console","log","elements","document","querySelectorAll","forEach","element","addEventListener","e","actionid","dataset","id","action","optionid","cmid","deleteForm","ModalForm","formClass","args","modalConfig","title","getString","returnFocus","events","FORM_SUBMITTED","window","location","reload","show","modalForm","target","name","value","skipClientValidation","button","querySelector","processNoSubmitButton","editActionsModal"],"mappings":"yHAgC4C,IAAAA;;;;;;;;;;;;;;kFAA5CC,YAA4CD,IAA5CC,aAA4CD,IAAAE,WAAAF,IAAAG,CAAAA,QAAAH,KAE5C,MAAMI,iBACS,kCAuBbC,SAAAC,KApBkBA,KAGhBC,QAAQC,IAAIJ,kBAEZ,MAAMK,SAAWC,SAASC,iBAAiBP,kBAG3CG,QAAQC,IAAIC,UAEZA,SAASG,SAAQC,UAIbA,QAAQC,iBAAiB,SAASC,KAY1C,SAA0BF,SAEtB,IAAKA,QACD,OAGJ,MAAMG,SAAWH,QAAQI,QAAQC,GAC3BC,OAASN,QAAQI,QAAQE,OACzBC,SAAWP,QAAQI,QAAQG,SAC3BC,KAAOR,QAAQI,QAAQI,KAE7B,IAAKL,SACD,OAGJ,GAAc,UAAVG,OAAoB,CAEpB,MAAMG,WAAa,IAAIC,WAAAA,QAAU,CAG7BC,UAAW,gDAEXC,KAAM,CAACP,GAAIF,SAAUK,UAAMD,mBAE3BM,YAAa,CACTC,OAAO,EAAAC,KAAAA,YAAU,sBAAuB,gBAG5CC,YAAahB,UAIjBS,WAAWR,iBAAiBQ,WAAWQ,OAAOC,gBAAgB,KAC1DC,OAAOC,SAASC,QAAQ,IAI5BZ,WAAWa,MAEf,KAAO,IAAc,eAAVhB,OA2CP,YADAZ,QAAQC,IAAI,+EA1CoB,CAEhC,MAAM4B,UAAY,IAAIb,WAAAA,QAAU,CAE5BC,UAAW,0CAEXC,KAAM,CAACP,GAAIF,SAAUK,UAAMD,mBAE3BM,YAAa,CAACC,OAAO,EAAAC,KAAAA,YAAU,aAAc,gBAE7CC,YAAahB,UAKjBuB,UAAUtB,iBAAiBsB,UAAUN,OAAOC,gBAAgB,KAGxDC,OAAOC,SAASC,QAAQ,IAI5BE,UAAUtB,iBAAiB,UAAWC,IAKlC,GAFAR,QAAQC,IAAIO,EAAEsB,OAAOC,KAAMvB,EAAEsB,OAAOE,OAE/BxB,EAAEsB,OAAOC,MAIO,eAAjBvB,EAAEsB,OAAOC,KAAuB,CAChCN,OAAOQ,sBAAuB,EAC9B,IAAIC,OAAS/B,SAASgC,cAAc,2BACpCN,UAAUO,sBAAsBF,OACpC,KAIJL,UAAUD,MACd,CAIA,CACJ,CA9FYS,CAAiB7B,EAAEsB,OAAO,GAE5B,GACJ,CA2FL"}