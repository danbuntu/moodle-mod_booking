{"version":3,"file":"wunderbyte.min.js","sources":["../src/wunderbyte.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/* eslint-disable no-empty-function */\n\n/**\n * WunderByte javascript library/framework\n *\n * @module mod_booking/wunderbyte\n * @copyright 2023 Kamil Hurajt <info@wunderbyte.at>\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * Sorting framework.\n */\nexport function WunderByteJS() {\n}\n\nWunderByteJS.prototype.sortable = function(opt) {\n    let sortableItems = [];\n    let sortableContainer = null;\n    let draggingItem = null;\n\n    let options = {\n        items: '.wb-item-sortable',\n        container: '.wb-item-container'\n    };\n\n    options = {...options, ...opt};\n\n    // eslint-disable-next-line no-console\n    console.log(options);\n\n    this.init = function() {\n        sortableItems = document.querySelectorAll(options.items);\n        sortableContainer = document.querySelector(options.container);\n        sortableItems.forEach(item => {\n            item.setAttribute('draggable', true);\n        });\n        if (sortableContainer) {\n            sortableContainer.addEventListener('dragstart', this.sortable.bind(this));\n        }\n    };\n\n    this.sortable = function(event) {\n        draggingItem = event.target.closest('.list-group-item');\n\n        // Limiting the movement type\n        event.dataTransfer.effectAllowed = 'move';\n        event.dataTransfer.setData('Text', draggingItem.textContent);\n\n        // Subscribing to the events\n        sortableContainer.addEventListener('dragover', this.dragOver.bind(this), false);\n        sortableContainer.addEventListener('dragend', this.dragEnd.bind(this), false);\n\n        setTimeout(function() {\n            draggingItem.classList.add('ghost');\n        }, 0);\n    };\n\n    this.getVerticalCenter = function(element) {\n        let r = element.getBoundingClientRect();\n        return (r.bottom - r.top) / 2;\n    };\n\n    this.getMouseOffset = function(event) {\n        const element = event.target.closest('.list-group-item');\n        let r = element.getBoundingClientRect();\n        return {\n            x: event.pageX - r.left,\n            y: event.pageY - r.top\n        };\n    };\n\n    this.dragOver = function(event) {\n        event.preventDefault();\n        event.dataTransfer.dropEffect = 'move';\n\n        var target = event.target.closest('.list-group-item');\n\n        if (target && target !== draggingItem && target.nodeName == 'LI') {\n            // Sorting\n\n            const offset = this.getMouseOffset(event);\n            const middleY = this.getVerticalCenter(target);\n\n            if (offset.y > middleY && target.nextSibling) {\n                sortableContainer.insertBefore(draggingItem, target.nextSibling);\n            } else if (target && target.className.indexOf(options.item) !== -1) {\n                sortableContainer.insertBefore(draggingItem, target);\n            }\n        }\n    };\n\n    this.dragEnd = function(event) {\n        event.preventDefault();\n        if (draggingItem) {\n            draggingItem.classList.remove('ghost');\n            sortableContainer.removeEventListener('dragover', this.dragOver, false);\n            sortableContainer.removeEventListener('dragend', this.dragEnd, false);\n\n            draggingItem = null;\n        }\n    };\n\n    this.init();\n};\n\nWunderByteJS.prototype.dragable = function(opt) {\n    let options = {\n        container: '.wb-droppable',\n        items: '.wb-item-draggable'\n    };\n\n    let draggingItem = null;\n\n    options = {...options, ...opt};\n\n    this.init = function() {\n        var items = document.querySelectorAll(options.items);\n\n        // Make items draggable\n        items.forEach(item => {\n            item.setAttribute('draggable', true);\n            item.addEventListener('dragstart', this.dragStart.bind(this));\n            item.addEventListener('dragend', this.dragEnd.bind(this));\n        });\n\n        var containers = document.querySelectorAll(options.container);\n\n        // Make containers listen to drop events\n        containers.forEach(container => {\n            container.classList.add('wb-droppable');\n\n            container.addEventListener('dragenter', this.dragEnter.bind(this));\n            container.addEventListener('dragover', this.dragOver.bind(this));\n            container.addEventListener('drop', this.dragDrop.bind(this));\n        });\n    };\n\n    this.dragStart = function() {\n        setTimeout(() => this.classList.add('hidden'), 0);\n        draggingItem = this;\n    };\n\n    this.dragEnd = function() {\n        this.classList.remove('hidden');\n        draggingItem = null;\n    };\n\n    this.dragDrop = function() {\n        this.append(draggingItem);\n    };\n\n    this.dragEnter = function(e) {\n        e.preventDefault();\n    };\n\n    this.dragOver = function(e) {\n        e.preventDefault();\n    };\n\n    return this.init();\n};\n"],"names":["WunderByteJS","prototype","sortable","opt","sortableItems","sortableContainer","draggingItem","options","items","container","console","log","this","init","document","querySelectorAll","querySelector","forEach","item","setAttribute","addEventListener","bind","event","target","closest","dataTransfer","effectAllowed","setData","textContent","dragOver","dragEnd","setTimeout","classList","add","getVerticalCenter","element","r","getBoundingClientRect","bottom","top","getMouseOffset","x","pageX","left","y","pageY","preventDefault","dropEffect","nodeName","offset","middleY","nextSibling","insertBefore","className","indexOf","remove","removeEventListener","dragable","dragStart","dragEnter","dragDrop","append","e"],"mappings":"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"}